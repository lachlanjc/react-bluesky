# Next.js

## Installation

> Next.js 13.2.1 or higher is required in order to use `bsky-react-post`.

Follow the [installation docs in the Introduction](/#installation).

## Usage

In any component, import `Post` from `bsky-react-post` and use it like so:

```tsx
import { Tweet } from "bsky-react-post";

export default function Page() {
  return (
    <Tweet uri="https://bsky.app/profile/adima7.bsky.social/post/3laq6uzwjbc2t" />
  );
}
```

`Post` works differently depending on where it's used. If it's used in the App Router it will fetch the post in the server. If it's used in the pages directory it will fetch the post in the client with [SWR](https://swr.vercel.app/).

You can learn more about `Post` in the [Bluesky theme docs](/bluesky-theme). And you can learn more about the usage in [Running the test app](#running-the-test-app).

### Troubleshooting

If you see an error saying that CSS can't be imported from `node_modules` in the `pages` directory. Add the following config to `next.config.js`:

```js
transpilePackages: ["bsky-react-post"];
```

The error won't happen if the App Router is enabled, where [Next.js supports CSS imports from `node_modules`](https://github.com/vercel/next.js/discussions/27953#discussioncomment-3978605).

### Enabling cache

It's recommended to enable cache for the Bluesky API if you intend to go to production. This is how you can do it with [`unstable_cache`](https://nextjs.org/docs/app/api-reference/functions/unstable_cache):

```tsx
import { Suspense } from "react";
import { unstable_cache } from "next/cache";
import { TweetSkeleton, EmbeddedTweet, TweetNotFound } from "react-tweet";
import { getTweet as _getTweet } from "react-tweet/api";

const getTweet = unstable_cache(
  async (id: string) => _getTweet(id),
  ["tweet"],
  { revalidate: 3600 * 24 }
);

const TweetPage = async ({ id }: { id: string }) => {
  try {
    const tweet = await getTweet(id);
    return tweet ? <EmbeddedTweet tweet={tweet} /> : <TweetNotFound />;
  } catch (error) {
    console.error(error);
    return <TweetNotFound error={error} />;
  }
};

const Page = ({ params }: { params: { tweet: string } }) => (
  <Suspense fallback={<TweetSkeleton />}>
    <TweetPage id={params.tweet} />
  </Suspense>
);

export default Page;
```

This can prevent getting your server IPs rate limited if they are making too many requests to the Bluesky API.

## Advanced usage

### Manual data fetching

You can use the [`getPost`](/api-reference#getpost) function from `bsky-react-post/api` to fetch the post manually. This is useful for SSG pages and for other [Next.js data fetching methods](https://nextjs.org/docs/basic-features/data-fetching/overview) in the `pages` directory.

For example, using `getStaticProps` in `pages/[post].tsx` to fetch the tweet and send it as props to the page component:

```tsx
import { useRouter } from "next/router";
import { getTweet, type Tweet } from "react-tweet/api";
import { EmbeddedTweet, TweetSkeleton } from "react-tweet";

export async function getStaticProps({
  params,
}: {
  params: { tweet: string };
}) {
  const tweetId = params.tweet;

  try {
    const tweet = await getTweet(tweetId);
    return tweet ? { props: { tweet } } : { notFound: true };
  } catch (error) {
    return { notFound: true };
  }
}

export async function getStaticPaths() {
  return { paths: [], fallback: true };
}

export default function Page({ tweet }: { tweet: Tweet }) {
  const { isFallback } = useRouter();
  return isFallback ? <TweetSkeleton /> : <EmbeddedTweet tweet={tweet} />;
}
```

## Running the test app

Clone the [`bsky-react-post`](https://github.com/rhinobase/react-bluesky) repository and then run the following command:

```bash
pnpm install && pnpm nx dev sandbox
```

The app will be up and running at http://localhost:3000 for the [Next.js app example](https://github.com/vercel-labs/react-tweet/tree/main/apps/next-app).

The source code for `bsky-react-post` is imported from [packages/core](https://github.com/rhinobase/react-bluesky/tree/main/packages/core) and any changes you make to it will be reflected in the app immediately.
